<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XIIM â€” Chat Demo</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a1a;color:#e0e0e0;font-family:system-ui,-apple-system,sans-serif;height:100vh;display:flex;flex-direction:column}
.header{padding:16px 24px;border-bottom:1px solid #1a1a2e;display:flex;align-items:center;gap:12px}
.header h1{font-size:1.2rem;background:linear-gradient(135deg,#a855f7,#6366f1);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.header .status{font-size:0.8rem;color:#4ade80;display:flex;align-items:center;gap:4px}
.header .status::before{content:"";width:8px;height:8px;background:#4ade80;border-radius:50%;display:inline-block}
.chat{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:12px}
.msg{max-width:80%;padding:12px 16px;border-radius:16px;line-height:1.5;font-size:0.95rem;animation:fadeIn .3s ease}
.msg.user{align-self:flex-end;background:linear-gradient(135deg,#6366f1,#a855f7);color:#fff;border-bottom-right-radius:4px}
.msg.agent{align-self:flex-start;background:#1a1a2e;border-bottom-left-radius:4px}
.msg.system{align-self:center;color:#666;font-size:0.85rem;font-style:italic}
.input-area{padding:16px 24px;border-top:1px solid #1a1a2e;display:flex;gap:12px}
.input-area input{flex:1;padding:12px 20px;border-radius:24px;border:1px solid #333;background:#111;color:#fff;font-size:1rem;outline:none}
.input-area input:focus{border-color:#6366f1}
.input-area button{padding:12px 24px;border-radius:24px;border:none;background:linear-gradient(135deg,#a855f7,#6366f1);color:#fff;font-size:1rem;cursor:pointer;font-weight:600;transition:opacity .2s}
.input-area button:hover{opacity:.9}
.input-area button:disabled{opacity:.5;cursor:not-allowed}
.typing{display:flex;gap:4px;padding:8px 16px}.typing span{width:8px;height:8px;background:#666;border-radius:50%;animation:bounce .6s infinite alternate}.typing span:nth-child(2){animation-delay:.2s}.typing span:nth-child(3){animation-delay:.4s}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes bounce{to{transform:translateY(-6px);opacity:1}}
.agent-select{padding:16px 24px;text-align:center}
.agent-select select{padding:8px 16px;border-radius:12px;border:1px solid #333;background:#111;color:#fff;font-size:0.9rem}
</style>
</head>
<body>
<div class="header">
  <h1>XIIM</h1>
  <span class="status" id="status">Online</span>
</div>
<div class="agent-select">
  <label style="color:#888;font-size:0.85rem">Agent: </label>
  <select id="agentSelect">
    <option value="3b308016-1797-41c8-90ca-3de49a560b03">Buddy (Max)</option>
    <option value="5549463a-27cf-4cf5-a5d2-17db9d1dd28d">Luna (Lisa)</option>
  </select>
</div>
<div class="chat" id="chat">
  <div class="msg system">Schreib eine Nachricht um loszulegen!</div>
</div>
<div class="input-area">
  <input type="text" id="input" placeholder="Nachricht schreiben..." autofocus>
  <button id="send" onclick="sendMsg()">Senden</button>
</div>
<script>
const API = "https://api.xii-m.com";
const AUTH = "admin:xiim2026beta";

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");

input.addEventListener("keydown", e => { if (e.key === "Enter" && !sendBtn.disabled) sendMsg(); });

async function sendMsg() {
  const msg = input.value.trim();
  if (!msg) return;
  
  const agentId = document.getElementById("agentSelect").value;
  
  // Show user message
  addMsg(msg, "user");
  input.value = "";
  sendBtn.disabled = true;
  
  // Show typing
  const typing = document.createElement("div");
  typing.className = "typing";
  typing.id = "typing";
  typing.innerHTML = "<span></span><span></span><span></span>";
  chat.appendChild(typing);
  chat.scrollTop = chat.scrollHeight;
  
  try {
    const resp = await fetch(API + "/chat", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Basic " + btoa(AUTH)
      },
      body: JSON.stringify({ agent_id: agentId, message: msg })
    });
    
    const data = await resp.json();
    typing.remove();
    addMsg(data.reply || "Keine Antwort", "agent");
  } catch (e) {
    typing.remove();
    addMsg("Verbindungsfehler: " + e.message, "system");
  }
  
  sendBtn.disabled = false;
  input.focus();
}

function addMsg(text, type) {
  const div = document.createElement("div");
  div.className = "msg " + type;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}
</script>
</body>
</html>
